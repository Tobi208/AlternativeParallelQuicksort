STENCIL_SZ=20, fusing the loops in v2:
Doing 400 iterations with N=232 using apply_stencil function version 1 took   2.297 wall seconds.
Doing 400 iterations with N=232 using apply_stencil function version 2 took   1.178 wall seconds.
Doing 400 iterations with N=232 using apply_stencil function version 3 took   2.297 wall seconds.

It does make the stencil a lot faster.


STENCIL_SZ=4
Doing 400 iterations with N=200 using apply_stencil function version 1 took   0.114 wall seconds.
Doing 400 iterations with N=200 using apply_stencil function version 2 took   0.079 wall seconds.
Doing 400 iterations with N=200 using apply_stencil function version 3 took   0.114 wall seconds.

The loop fusion is still a bit faster but the speedup is not as big anymore.
I guess the compiler was supposed to automatically optimize the loops for a sufficiently low stencil size but didn't?