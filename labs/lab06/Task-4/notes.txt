Yes, this time I actually get a speedup from __restricted:

transform_std tests took   0.935 wall seconds.
transform_opt tests took   0.656 wall seconds.


After changing np to NP:

transform_std tests took   0.936 wall seconds.
transform_opt tests took   0.566 wall seconds.

Helps a lot actually.


After changing NP to const:

transform_std tests took   0.936 wall seconds.
transform_opt tests took   0.126 wall seconds.

Is pretty powerful, probably enables a lot of compiler optimization.


After moving int NP = 2 into the function:

transform_std tests took   0.936 wall seconds.
transform_opt tests took   0.126 wall seconds.

After making it const:

transform_std tests took   0.935 wall seconds.
transform_opt tests took   0.126 wall seconds.

Looks like moving it into the function already enables the compiler to determine that NP is constant.